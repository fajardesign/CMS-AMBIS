<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AMBIS — Payroll</title>

  <script>
    try {
      if (localStorage.getItem('ambis:sidebar-collapsed') === '1') {
        document.documentElement.classList.add('sidebar-collapsed');
      }
    } catch {}
  </script>

  <!-- Tailwind + fonts -->
  <script>
    tailwind = window.tailwind || {};
    const modalSafelist = window.AMBIS_MODAL_SAFELIST || (window.AMBIS_MODAL_SAFELIST = [
      'fixed','inset-0','z-[9999]','hidden','grid','place-items-center','overflow-y-auto','bg-slate-950/70','px-4','py-6','backdrop-blur-sm','sm:px-6',
      'relative','w-full','max-w-md','overflow-hidden','rounded-2xl','bg-white','px-6','py-8','text-center','shadow-2xl','ring-1','ring-black/5','transition',
      'mx-auto','flex','h-16','w-16','items-center','justify-center','rounded-full','bg-cyan-500','text-white','shadow-lg','shadow-cyan-500/40',
      'text-3xl','font-bold','mt-6','space-y-3','text-xl','font-semibold','text-slate-900','text-base','text-slate-600','mt-8','inline-flex',
      'bg-cyan-600','px-5','py-3','shadow-cyan-600/40','hover:-translate-y-px','hover:bg-cyan-500',
      'focus-visible:outline','focus-visible:outline-2','focus-visible:outline-offset-2','focus-visible:outline-cyan-400'
    ]);
    tailwind.config = {
      safelist: [
        ...modalSafelist,
        'opacity-0','opacity-100','translate-y-0','translate-y-1',
        'ring-2','ring-cyan-400','bg-cyan-50','border-cyan-300',
        'text-slate-900','text-slate-400'
      ]
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Global styles -->
  <link rel="stylesheet" href="styles.css">
  <style>
  </style>
</head>
<body class="font-[Mulish] bg-gray-50 text-slate-900">
  <div class="h-screen overflow-hidden flex">

    <!-- SIDEBAR -->
    <aside id="sidebar" class="sb-bg sticky top-0 self-start h-screen w-[300px] text-slate-300 relative border-r border-slate-800/60 shrink-0 overflow-hidden">

      <div class="px-6 pt-6 flex items-center gap-4 overflow-hidden">
        <img
          src="img/ambis-vertical-logo.svg"
          alt="AMBIS"
          class="w-14 h-14 flex-none"
        />

        <div class="sb-label min-w-0 pr-2">
          <p
            id="brandName"
            class="text-slate-400 text-[18px] leading-tight whitespace-normal break-words"
            data-brand-name
          ></p>

        </div>
      </div>



      <nav class="mt-8 px-4 pb-28">
        <p class="px-2 text-[11px] tracking-[.18em] text-slate-400/80 mb-3">UTAMA</p>

        <a href="dashboard.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/dashboard.svg" alt="">
          <span class="sb-label text-slate-400 text-[16px]">Beranda</span>
        </a>

        <a href="informasi-rekening.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/inforekening.svg" alt="">
          <span class="sb-label sb-text text-[16px]">Informasi Rekening</span>
        </a>

        <a href="transfer.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/transfer.svg" alt="">
          <span class="sb-label sb-text text-[16px]">Transfer</span>
        </a>

        <a href="persetujuan-transaksi.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/otorisasi.svg" alt="">
          <span class="sb-label sb-text text-[16px]">Persetujuan Transaksi</span>
        </a>

        <a href="biller.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
            <img class="block w-6 h-6" src="img/sidebar/biller.svg" alt="">
          <span class="sb-label text-[16px] font-medium">Beli &amp; Bayar</span>
        </a>

        <a href="mutasi.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/mutasi.svg" alt="">
          <span class="sb-label sb-text text-[16px]">Mutasi &amp; e-Statement</span>
        </a>

        <a href="payroll.html" aria-current="page" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/payroll-active.svg" alt="">
          <span class="sb-label sb-text text-[16px]">Payroll</span>
        </a>

        <p class="px-2 mt-7 text-[11px] tracking-[.18em] text-slate-400/80 mb-3">ATUR</p>

        <a href="manajemen-pengguna.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/user.svg" alt="">
          <span class="sb-label sb-text text-[16px]">Manajemen Pengguna</span>
        </a>

        <a href="batas-transaksi.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/limit.svg" alt="">
          <span class="sb-label sb-text text-[16px]">Batas Transaksi</span>
        </a>

        <a href="atur-persetujuan.html" class="sb-item group flex items-center gap-3 px-3 py-3 rounded-xl border border-transparent hover:border-slate-700/60 hover:bg-white/[.03] transition">
          <img class="w-6 h-6" src="img/sidebar/akses.svg" alt="">
          <span class="sb-label sb-text text-[16px]">Atur Persetujuan</span>
        </a>
      </nav>

      <div class="absolute left-0 right-0 bottom-0 border-t border-white/10 px-6 py-4 flex items-center justify-between">
        <span id="collapseLabel" class="sb-label text-slate-300">Perkecil Navigasi</span>
        <button id="navToggle" aria-expanded="true"
                class="w-6 h-6 grid place-items-center rounded-md border border-white/15 bg-white/5 hover:bg-white/10">
          <img id="collapseIcon" src="img/shrink.svg" alt="" class="w-4 h-4">
        </button>
      </div>
    </aside>
    <!-- ============ /SIDEBAR ============ -->

    <!-- ============ MAIN ============ -->
    <main class="flex-1 min-w-0 bg-white h-screen overflow-y-auto">
      <div class="px-6 py-2">

        <!-- Header row -->
        <div class="flex items-center justify-between flex-wrap gap-4 mb-6 pb-2 border-b border-slate-200">
          <div class="h-16 flex items-center gap-3">
              <img src="img/header/payroll.svg" alt="Payroll"/>
              <h1 class="text-[24px] leading-none tracking-tight font-semibold">Payroll</h1>
          </div>
          <div class="flex items-center gap-2">
            <button class="px-4 py-2 rounded-xl border text-base bg-white hover:bg-slate-50 flex items-center gap-2">
              <img src="img/dashboard/bantuan.svg" alt="Notifikasi" class="w-5 h-5 object-contain" />
              <span class="text-slate-700 font-medium">Bantuan</span>
            </button>
            <button class="px-4 py-2 rounded-xl border text-base bg-white hover:bg-slate-50 flex items-center gap-2" data-logout-button>
              <img src="img/dashboard/keluar.svg" alt="Keluar" class="w-5 h-5 object-contain" />
              <span class="text-slate-700 font-medium">Keluar</span>
            </button>
          </div>
        </div>

        <section id="existingPayrollContent" class="space-y-6">
          <article class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-[0_20px_45px_rgba(9,12,34,0.04)] space-y-5" style="padding:24pt;">
            <img src="img/hero-bg.svg" alt="" class="pointer-events-none absolute left-0 top-0 h-full w-[529px] object-cover" aria-hidden="true">

            <div class="relative space-y-5">
              <div class="flex flex-wrap items-center gap-3">
                <p id="payrollStatusBadge" class="inline-flex items-center gap-2 rounded-[8pt] border border-[#ebebeb] bg-white px-3 py-1 text-sm font-semibold text-emerald-700">
                  <img src="img/select-box-circle-fill.svg" alt="" class="w-4 h-4">
                  Payroll Aktif
                </p>
              </div>

              <header class="space-y-2">
                <h2 class="text-[20px] font-bold text-slate-900">Kelola Penggajian Lebih Mudah</h2>
                <p class="text-[16px] text-[#7d7d7d]">Susun jadwal pembayaran gaji, atur benefit, dan pantau status payroll dalam satu dashboard terintegrasi.</p>
              </header>

              <div class="grid gap-4">
                <div class="flex flex-wrap items-start gap-4 rounded-2xl border border-cyan-100 bg-[#F2F9FF] px-5 py-4">
                  <img src="img/icon/infirmation-fill.svg" alt="Info" class="mt-1 h-6 w-6 shrink-0">
                  <div class="space-y-1 min-w-0">
                    <p class="text-[16px] font-semibold text-slate-900">Hubungkan Rekening Karyawan</p>
                    <p class="text-[16px] text-slate-700">Bagikan <strong>kode registrasi di bawah ini</strong> kepada karyawan agar terhubung dengan sistem Payroll Amar Bank.</p>
                  </div>
                </div>

                <div id="registrationCodeCard" class="flex w-1/2 items-center justify-between gap-4 rounded-[12px] border-2 border-dashed border-[#009faf] bg-[#e4fbf8] px-4 py-3">
                  <div id="registrationCodeLeft" class="flex min-w-0 items-center gap-3">
                    <img src="img/General Widget/Amar Bank/lg-amarbank_logogram.svg" alt="Amar Bank" class="h-[24px] w-[32px] shrink-0">
                    <div class="min-w-0">
                      <p id="registrationCodeLabel" class="text-[16px] font-normal leading-6 text-slate-800">Kode Registrasi Payroll</p>
                      <p id="registrationCodeValue" class="hidden text-[24px] font-bold leading-8 text-slate-800"></p>
                    </div>
                  </div>

                  <div id="registrationCodeRight" class="flex shrink-0 items-center gap-3">
                    <button
                      id="generateCodeBtn"
                      type="button"
                      class="inline-flex h-10 min-w-[100px] items-center justify-center rounded-[10px] bg-[#009faf] px-4 text-[16px] font-semibold text-white transition hover:brightness-105 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#009faf]"
                    >
                      Buat Kode
                    </button>

                    <div id="codeGeneratedMeta" class="hidden items-center gap-3">
                      <p class="text-[16px] font-normal text-slate-600">Expired <span class="text-[16px] font-bold text-[#e38319]">20 Hari</span></p>
                      <img src="img/icon/General Widget/file-copy-line.svg" alt="Copy code" class="h-6 w-6">
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </article>

          <div class="grid gap-6 lg:grid-cols-2">
            <article class="rounded-2xl border border-slate-200 bg-white shadow-[0_20px_45px_rgba(9,12,34,0.04)] p-6 space-y-4">
              <h3 class="text-[20px] font-bold text-slate-900">Panduan Registrasi Rekening Payroll</h3>
              <ul class="space-y-4 text-slate-700">
                <li class="flex items-start gap-3">
                  <img src="img/icon/playstore.svg" alt="Play Store" class="h-12 w-12 shrink-0">
                  <p class="text-[16px]">Minta karyawan menginstal aplikasi <strong>Amar Bank Digital</strong>.</p>
                </li>
                <li class="flex items-start gap-3">
                  <img src="img/icon/digital-form.svg" alt="Form Digital" class="h-12 w-12 shrink-0">
                  <p class="text-[16px]">Arahkan karyawan untuk <strong>membuka rekening</strong> secara digital.</p>
                </li>
                <li class="flex items-start gap-3">
                  <img src="img/icon/share.svg" alt="Bagikan" class="h-12 w-12 shrink-0">
                  <p class="text-[16px]">Bagikan <strong>kode registrasi payroll</strong> ke karyawan.</p>
                </li>
                <li class="flex items-start gap-3">
                  <img src="img/icon/phone.svg" alt="Telepon" class="h-12 w-12 shrink-0">
                  <p class="text-[16px]">Karyawan memasukkan <strong>Kode Registrasi Payroll</strong> melalui aplikasi Amar Bank Digital.</p>
                </li>
                <li class="flex items-start gap-3">
                  <img src="img/icon/check.svg" alt="Cek" class="h-12 w-12 shrink-0">
                  <p class="text-[16px]">Cek dashboard payroll untuk melihat rekening karyawan yang akan terhubung dengan payroll.</p>
                </li>
              </ul>
            </article>

            <article class="rounded-2xl border border-slate-200 bg-white shadow-[0_20px_45px_rgba(9,12,34,0.04)] p-6 space-y-4">
              <h3 class="text-[20px] font-bold text-slate-900">Manfaat Payroll Amar Bank</h3>
              <ul class="space-y-4 text-slate-700">
                <li class="flex items-start gap-3">
                  <span class="mt-0.5 flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 text-lg">✓</span>
                  <div>
                    <p class="text-[20px] font-bold text-slate-900 leading-tight">Pembayaran Gaji Lebih Cepat &amp; Akurat</p>
                    <p class="text-[16px] text-slate-500">Proses penggajian dilakukan otomatis sesuai data karyawan.</p>
                  </div>
                </li>
                <li class="flex items-start gap-3">
                  <span class="mt-0.5 flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 text-lg">✓</span>
                  <div>
                    <p class="text-[20px] font-bold text-slate-900 leading-tight">Integrasi Langsung dengan Amar Bank Digital</p>
                    <p class="text-[16px] text-slate-500">Rekening karyawan terhubung otomatis melalui kode bisnis.</p>
                  </div>
                </li>
                <li class="flex items-start gap-3">
                  <span class="mt-0.5 flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 text-lg">✓</span>
                  <div>
                    <p class="text-[20px] font-bold text-slate-900 leading-tight">Transfer Gaji Seketika atau Terjadwal</p>
                    <p class="text-[16px] text-slate-500">Pilih pembayaran langsung atau terjadwal sesuai kebutuhan perusahaan.</p>
                  </div>
                </li>
                <li class="flex items-start gap-3">
                  <span class="mt-0.5 flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 text-lg">✓</span>
                  <div>
                    <p class="text-[20px] font-bold text-slate-900 leading-tight">Mendukung Pengelolaan Karyawan yang Lebih Tertib</p>
                    <p class="text-[16px] text-slate-500">Data tersinkron otomatis dari CMS, sehingga meminimalkan duplikasi atau ketidaksesuaian data.</p>
                  </div>
                </li>
              </ul>
            </article>
          </div>
        </section>

        <section id="listAccountLayout" class="hidden space-y-5">
          <article class="rounded-[24px] border border-[#ebebeb] bg-white p-6">
            <div class="grid gap-4 xl:grid-cols-[1.65fr_1fr]">
              <div class="space-y-4">
                <div class="space-y-2">
                  <h2 class="text-[20px] font-bold leading-tight text-slate-900">Kelola Penggajian Lebih Mudah</h2>
                  <p class="max-w-[780px] text-[16px] leading-7 text-[#5c5c5c]">
                    Susun jadwal pembayaran gaji, atur benefit, dan pantau status payroll dalam satu dashboard terintegrasi.
                    <a href="#" class="font-bold text-[#009faf] hover:underline">Lihat Panduan Disini</a>
                  </p>
                </div>

                <div id="registrationCodeCardSpecial" class="flex w-full max-w-[560px] items-center justify-between gap-4 rounded-[12px] border-2 border-dashed border-[#009faf] bg-white px-4 py-3">
                  <div class="flex min-w-0 items-center gap-3">
                    <img src="img/General Widget/Amar Bank/lg-amarbank_logogram.svg" alt="Amar Bank" class="h-[24px] w-[32px] shrink-0">
                    <div class="min-w-0">
                      <p id="registrationCodeLabelSpecial" class="text-[16px] font-normal leading-6 text-slate-800">Kode Registrasi Payroll</p>
                      <p id="registrationCodeValueSpecial" class="hidden text-[24px] font-bold leading-8 text-slate-800"></p>
                    </div>
                  </div>

                  <div class="flex shrink-0 items-center gap-3">
                    <button
                      id="generateCodeBtnSpecial"
                      type="button"
                      class="inline-flex h-10 min-w-[100px] items-center justify-center rounded-[10px] bg-[#009faf] px-4 text-[16px] font-semibold text-white transition hover:brightness-105 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#009faf]"
                    >
                      Buat Kode
                    </button>

                    <div id="codeGeneratedMetaSpecial" class="hidden items-center gap-3">
                      <p class="text-[16px] font-normal text-slate-600">Expired <span class="text-[16px] font-bold text-[#e38319]">20 Hari</span></p>
                      <img src="img/icon/General Widget/file-copy-line.svg" alt="Copy code" class="h-6 w-6">
                    </div>
                  </div>
                </div>
              </div>

              <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-1">
                <article class="rounded-2xl border border-[#d1d1d1] bg-white bg-[url('img/hero-bg.svg')] bg-cover bg-right-top p-4">
                  <div class="mb-3 flex items-start justify-between gap-4">
                    <p class="text-[16px] text-[#5c5c5c]">Sisa Limit Harian Payroll</p>
                    <div class="group relative">
                      <img src="img/icon/info.svg" alt="Info" class="h-5 w-5">
                      <span class="pointer-events-none absolute right-0 top-6 hidden w-[180px] rounded-lg bg-slate-800 px-3 py-2 text-[12px] text-white group-hover:block">Informasi limit harian payroll.</span>
                    </div>
                  </div>
                  <p class="text-[18px] font-bold text-slate-900">Rp1.000.000.000</p>
                  <div class="mt-3 h-[6px] rounded-full bg-[#dff1ef]"><div class="h-full w-full rounded-full bg-[#009faf]"></div></div>
                  <p class="mt-2 text-[12px] text-[#5c5c5c]">dari total Rp1.000.000.000</p>
                </article>

                <article class="rounded-2xl border border-[#d1d1d1] bg-white bg-[url('img/hero-bg.svg')] bg-cover bg-right-top p-4">
                  <div class="mb-3 flex items-start justify-between gap-4">
                    <p class="text-[16px] text-[#5c5c5c]">Rekening Karyawan</p>
                    <div class="group relative">
                      <img src="img/icon/info.svg" alt="Info" class="h-5 w-5">
                      <span class="pointer-events-none absolute right-0 top-6 hidden w-[180px] rounded-lg bg-slate-800 px-3 py-2 text-[12px] text-white group-hover:block">Informasi status rekening karyawan.</span>
                    </div>
                  </div>
                  <p class="text-[24px] font-bold text-slate-900">150</p>
                  <div class="mt-3 flex flex-wrap items-center gap-2 text-[14px]">
                    <span class="inline-flex items-center rounded-full bg-[#f1f9ef] px-3 py-1 text-[#54a648]">0 Aktif</span>
                    <span class="inline-flex items-center rounded-full bg-[#fef5e8] px-3 py-1 text-[#e38319]">150 Pending</span>
                  </div>
                </article>
              </div>
            </div>
          </article>

          <article class="space-y-4">
            <div class="flex flex-wrap items-center justify-between gap-3">
              <label class="relative block w-full max-w-[349px]">
                <img src="img/icon/filter.svg" alt="Cari" class="pointer-events-none absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 opacity-60">
                <input id="employeeSearchInput" type="text" placeholder="Cari data karyawan" class="h-[48px] w-full rounded-xl border border-[#d1d1d1] bg-white pl-11 pr-3 text-[16px] text-slate-700 placeholder:text-[#9e9e9e] focus:border-[#009faf] focus:outline-none">
              </label>

              <div class="flex flex-wrap items-center gap-2">
                <button type="button" class="inline-flex h-12 items-center rounded-xl border border-[#009faf] bg-white px-4 text-[16px] font-semibold text-[#009faf]">Download Template</button>
                <button id="createPayrollBtn" type="button" class="inline-flex h-12 items-center rounded-xl border border-[#009faf] bg-[#009faf] px-4 text-[16px] font-semibold text-white disabled:cursor-not-allowed disabled:opacity-50">Buat Penggajian</button>
              </div>
            </div>

            <div class="border-b border-slate-200">
              <nav id="accountTabs" class="flex flex-wrap items-center gap-8 text-[16px] leading-tight text-[#5c5c5c]"></nav>
            </div>

            <div class="overflow-hidden rounded-2xl border border-[#ebebeb] bg-white">
              <div class="overflow-x-auto">
                <table class="min-w-full text-left text-[16px] text-slate-700">
                  <thead class="bg-[#f3f3f3] text-[16px] font-semibold text-[#5c5c5c]">
                    <tr>
                      <th class="w-12 px-4 py-3"><input type="checkbox" aria-label="Pilih semua"></th>
                      <th class="px-4 py-3">Nama Lengkap</th>
                      <th class="px-4 py-3">NIK</th>
                      <th class="px-4 py-3">Email Address</th>
                      <th class="px-4 py-3">Nomor Rekening</th>
                      <th class="px-4 py-3">Status Rekening</th>
                      <th class="px-4 py-3 text-right">Aksi</th>
                    </tr>
                  </thead>
                  <tbody id="employeeTableBody" class="divide-y divide-slate-200"></tbody>
                </table>
              </div>

              <div class="flex flex-wrap items-center justify-between gap-2 border-t border-slate-200 px-4 py-3">
                <p id="employeePaginationText" class="text-[12px] text-[#5c5c5c]"></p>
                <div class="flex items-center gap-2">
                  <button id="employeePrevPage" class="rounded-lg border border-slate-200 px-3 py-1 text-[14px] text-slate-600 disabled:opacity-40" type="button">Prev</button>
                  <button id="employeeNextPage" class="rounded-lg border border-slate-200 px-3 py-1 text-[14px] text-slate-600 disabled:opacity-40" type="button">Next</button>
                </div>
              </div>
            </div>
          </article>
        </section>

      </div>
    </main>
    <!-- ============ /MAIN ============ -->

  </div>

  <script src="session.js"></script>
  <script src="sidebar.js"></script>
  <script>
    const state = {
      payrollActive: true,
      hasPermission: true,
      accountsLoading: true,
      accountsError: false,
      accounts: [],
      useSpecialPayrollLayout: false,
      activeTab: 'active',
      searchQuery: '',
      currentPage: 1,
      perPage: 10,
    };

    const payrollStatusBadge = document.getElementById('payrollStatusBadge');
    const accountLoadingEl = document.getElementById('accountLoading');
    const accountErrorEl = document.getElementById('accountError');
    const accountEmptyEl = document.getElementById('accountEmpty');
    const retryAccountsBtn = document.getElementById('retryAccounts');
    const generateCodeBtn = document.getElementById('generateCodeBtn');
    const registrationCodeLabel = document.getElementById('registrationCodeLabel');
    const registrationCodeValue = document.getElementById('registrationCodeValue');
    const codeGeneratedMeta = document.getElementById('codeGeneratedMeta');
    const existingPayrollContent = document.getElementById('existingPayrollContent');
    const listAccountLayout = document.getElementById('listAccountLayout');

    const generateCodeBtnSpecial = document.getElementById('generateCodeBtnSpecial');
    const registrationCodeLabelSpecial = document.getElementById('registrationCodeLabelSpecial');
    const registrationCodeValueSpecial = document.getElementById('registrationCodeValueSpecial');
    const codeGeneratedMetaSpecial = document.getElementById('codeGeneratedMetaSpecial');

    const accountTabs = document.getElementById('accountTabs');
    const employeeSearchInput = document.getElementById('employeeSearchInput');
    const employeeTableBody = document.getElementById('employeeTableBody');
    const createPayrollBtn = document.getElementById('createPayrollBtn');
    const employeePaginationText = document.getElementById('employeePaginationText');
    const employeePrevPage = document.getElementById('employeePrevPage');
    const employeeNextPage = document.getElementById('employeeNextPage');

    const registrationCodeState = {
      isLoading: false,
      generatedCode: '',
    };

    const listAccountTabs = [
      { key: 'active', label: 'Rekening Aktif' },
      { key: 'confirm', label: 'Butuh Konfirmasi Anda', badge: 50 },
      { key: 'approval', label: 'Menunggu Persetujuan' },
    ];

    function generateEmployees(count, status) {
      const statusLabel = {
        active: 'Aktif',
        confirm: 'Butuh Konfirmasi',
        approval: 'Menunggu Persetujuan',
      };

      return Array.from({ length: count }, (_, index) => {
        const id = index + 1;
        const name = `Karyawan ${status.toUpperCase()} ${id}`;
        const nik = `20198293${String(9300 + id).padStart(4, '0')}`;
        const accountNumber = `1012928${String(370000 + id).padStart(6, '0')}`;
        return {
          id: `${status}-${id}`,
          name,
          nik,
          email: `karyawan.${status}.${id}@saranapancing.id`,
          accountNumber,
          status,
          statusLabel: statusLabel[status],
        };
      });
    }

    const listAccountData = {
      active: generateEmployees(100, 'active'),
      confirm: generateEmployees(50, 'confirm'),
      approval: generateEmployees(6, 'approval'),
    };

    function shuffleText(text) {
      const chars = text.split('');
      for (let i = chars.length - 1; i > 0; i -= 1) {
        const randomIndex = Math.floor(Math.random() * (i + 1));
        [chars[i], chars[randomIndex]] = [chars[randomIndex], chars[i]];
      }
      return chars.join('');
    }

    function generatePayrollCode() {
      const lowercase = 'abcdefghijklmnopqrstuvwxyz';
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      const allCharacters = `${lowercase}${uppercase}${numbers}`;

      const initialChars = [
        lowercase[Math.floor(Math.random() * lowercase.length)],
        uppercase[Math.floor(Math.random() * uppercase.length)],
        numbers[Math.floor(Math.random() * numbers.length)],
      ];

      while (initialChars.length < 6) {
        initialChars.push(allCharacters[Math.floor(Math.random() * allCharacters.length)]);
      }

      return shuffleText(initialChars.join(''));
    }

    function renderRegistrationCode(config) {
      const {
        generateButton,
        label,
        value,
        generatedMeta,
      } = config;

      if (!generateButton || !label || !value || !generatedMeta) return;

      if (registrationCodeState.isLoading) {
        generateButton.disabled = true;
        generateButton.innerHTML = '<img src="img/icon/General Widget/System Icons/ic-loading.svg" alt="Loading" class="h-5 w-5 animate-spin">';
        return;
      }

      generateButton.disabled = false;

      if (registrationCodeState.generatedCode) {
        label.textContent = 'Kode Payroll';
        value.textContent = registrationCodeState.generatedCode;
        value.classList.remove('hidden');
        generateButton.classList.add('hidden');
        generatedMeta.classList.remove('hidden');
        generatedMeta.classList.add('flex');
      } else {
        label.textContent = 'Kode Registrasi Payroll';
        value.textContent = '';
        value.classList.add('hidden');
        generateButton.classList.remove('hidden');
        generateButton.textContent = 'Buat Kode';
        generatedMeta.classList.add('hidden');
        generatedMeta.classList.remove('flex');
      }
    }

    function setVisibility(element, show) {
      if (!element) return;
      element.classList.toggle('hidden', !show);
    }

    function renderHero() {
      setVisibility(payrollStatusBadge, state.payrollActive);
    }

    function isSpecialPayrollUser() {
      const userName = window.AMBIS_SESSION?.userName || '';
      const brandName = window.AMBIS_SESSION?.brandName || '';
      return userName.trim().toLowerCase() === 'fajar' && brandName.trim().toLowerCase() === 'pt sarana pancing indonesia';
    }

    function getFilteredEmployees() {
      const source = listAccountData[state.activeTab] || [];
      if (!state.searchQuery) return source;
      const query = state.searchQuery.toLowerCase();
      return source.filter((employee) => (
        employee.name.toLowerCase().includes(query)
        || employee.nik.toLowerCase().includes(query)
        || employee.email.toLowerCase().includes(query)
        || employee.accountNumber.toLowerCase().includes(query)
      ));
    }

    function getStatusBadge(status) {
      if (status === 'confirm') {
        return '<span class="inline-flex rounded-full bg-[#fef5e8] px-3 py-1 text-[13px] text-[#e38319]">Butuh Konfirmasi</span>';
      }
      if (status === 'approval') {
        return '<span class="inline-flex rounded-full bg-[#eef5ff] px-3 py-1 text-[13px] text-[#4b78d6]">Menunggu Persetujuan</span>';
      }
      return '<span class="inline-flex rounded-full bg-[#f1f9ef] px-3 py-1 text-[13px] text-[#54a648]">Aktif</span>';
    }

    function renderListAccountTabs() {
      if (!accountTabs) return;
      accountTabs.innerHTML = listAccountTabs.map((tab) => {
        const isActive = tab.key === state.activeTab;
        return `
          <button
            type="button"
            data-tab-key="${tab.key}"
            class="inline-flex items-center gap-2 border-b-2 pb-3 text-[16px] leading-tight ${isActive ? 'border-[#009faf] font-bold text-slate-900' : 'border-transparent font-normal text-[#5c5c5c]'}"
          >
            ${tab.label}
            ${tab.badge ? `<span class="inline-flex h-6 min-w-6 items-center justify-center rounded-full bg-[#ef4444] px-2 text-[14px] font-bold text-white">${tab.badge}</span>` : ''}
          </button>
        `;
      }).join('');
    }

    function renderEmployeeTable() {
      if (!employeeTableBody || !employeePaginationText || !employeePrevPage || !employeeNextPage) return;
      const filteredEmployees = getFilteredEmployees();
      const totalPages = Math.max(1, Math.ceil(filteredEmployees.length / state.perPage));

      if (state.currentPage > totalPages) {
        state.currentPage = totalPages;
      }

      const startIndex = (state.currentPage - 1) * state.perPage;
      const pageItems = filteredEmployees.slice(startIndex, startIndex + state.perPage);

      employeeTableBody.innerHTML = pageItems.map((employee) => `
        <tr>
          <td class="px-4 py-3"><input type="checkbox" aria-label="Pilih ${employee.name}"></td>
          <td class="px-4 py-3 font-semibold text-slate-900">${employee.name}</td>
          <td class="px-4 py-3">${employee.nik}</td>
          <td class="px-4 py-3">${employee.email}</td>
          <td class="px-4 py-3">${employee.accountNumber}</td>
          <td class="px-4 py-3">${getStatusBadge(employee.status)}</td>
          <td class="px-4 py-3">
            <div class="flex items-center justify-end gap-2">
              <button type="button" class="inline-flex h-9 w-9 items-center justify-center rounded-lg border border-slate-200" aria-label="Tolak">
                <span class="text-lg leading-none text-[#ef4444]">✕</span>
              </button>
              <button type="button" class="inline-flex h-9 w-9 items-center justify-center rounded-lg border border-slate-200" aria-label="Setujui">
                <span class="text-lg leading-none text-[#009faf]">✓</span>
              </button>
            </div>
          </td>
        </tr>
      `).join('');

      if (!pageItems.length) {
        employeeTableBody.innerHTML = '<tr><td colspan="7" class="px-4 py-6 text-center text-[#5c5c5c]">Data tidak ditemukan.</td></tr>';
      }

      const startLabel = filteredEmployees.length ? startIndex + 1 : 0;
      const endLabel = Math.min(startIndex + state.perPage, filteredEmployees.length);
      employeePaginationText.textContent = `Menampilkan ${startLabel}-${endLabel} dari ${filteredEmployees.length} data`;

      employeePrevPage.disabled = state.currentPage === 1;
      employeeNextPage.disabled = state.currentPage === totalPages;

      const activeEmployees = listAccountData.active.length;
      if (createPayrollBtn) {
        createPayrollBtn.disabled = activeEmployees === 0;
      }
    }

    function renderPayrollLayout() {
      if (!existingPayrollContent || !listAccountLayout) return;
      existingPayrollContent.classList.toggle('hidden', state.useSpecialPayrollLayout);
      listAccountLayout.classList.toggle('hidden', !state.useSpecialPayrollLayout);
    }

    function renderAccounts() {
      setVisibility(accountLoadingEl, state.accountsLoading);
      setVisibility(accountErrorEl, state.accountsError);
      setVisibility(accountEmptyEl, !state.accountsLoading && !state.accountsError && state.accounts.length === 0);
    }

    function fetchAccounts() {
      state.accountsLoading = true;
      state.accountsError = false;
      renderAccounts();

      return new Promise((resolve) => setTimeout(resolve, 800)).then(() => {
        state.accountsLoading = false;
        state.accountsError = false;
        state.accounts = [];
        renderAccounts();
      }).catch(() => {
        state.accountsLoading = false;
        state.accountsError = true;
        renderAccounts();
      });
    }

    renderHero();

    state.useSpecialPayrollLayout = isSpecialPayrollUser() && [
      ...listAccountData.active,
      ...listAccountData.confirm,
      ...listAccountData.approval,
    ].length > 0;

    if (listAccountData.confirm.length > 0) {
      state.activeTab = 'confirm';
    }

    renderPayrollLayout();
    renderListAccountTabs();
    renderEmployeeTable();

    accountTabs?.addEventListener('click', (event) => {
      const tabButton = event.target instanceof Element ? event.target.closest('[data-tab-key]') : null;
      if (!tabButton) return;
      state.activeTab = tabButton.getAttribute('data-tab-key') || 'active';
      state.currentPage = 1;
      renderListAccountTabs();
      renderEmployeeTable();
    });

    employeeSearchInput?.addEventListener('input', (event) => {
      state.searchQuery = event.target.value.trim();
      state.currentPage = 1;
      renderEmployeeTable();
    });

    employeePrevPage?.addEventListener('click', () => {
      state.currentPage = Math.max(1, state.currentPage - 1);
      renderEmployeeTable();
    });

    employeeNextPage?.addEventListener('click', () => {
      state.currentPage += 1;
      renderEmployeeTable();
    });

    retryAccountsBtn?.addEventListener('click', () => {
      fetchAccounts();
    });

    function handleGenerateCode() {
      registrationCodeState.isLoading = true;
      renderRegistrationCode({
        generateButton: state.useSpecialPayrollLayout ? generateCodeBtnSpecial : generateCodeBtn,
        label: state.useSpecialPayrollLayout ? registrationCodeLabelSpecial : registrationCodeLabel,
        value: state.useSpecialPayrollLayout ? registrationCodeValueSpecial : registrationCodeValue,
        generatedMeta: state.useSpecialPayrollLayout ? codeGeneratedMetaSpecial : codeGeneratedMeta,
      });

      setTimeout(() => {
        registrationCodeState.generatedCode = generatePayrollCode();
        registrationCodeState.isLoading = false;
        renderRegistrationCode({
          generateButton: state.useSpecialPayrollLayout ? generateCodeBtnSpecial : generateCodeBtn,
          label: state.useSpecialPayrollLayout ? registrationCodeLabelSpecial : registrationCodeLabel,
          value: state.useSpecialPayrollLayout ? registrationCodeValueSpecial : registrationCodeValue,
          generatedMeta: state.useSpecialPayrollLayout ? codeGeneratedMetaSpecial : codeGeneratedMeta,
        });
      }, 1200);
    }

    generateCodeBtn?.addEventListener('click', handleGenerateCode);
    generateCodeBtnSpecial?.addEventListener('click', handleGenerateCode);

    fetchAccounts();
    renderRegistrationCode({
      generateButton: state.useSpecialPayrollLayout ? generateCodeBtnSpecial : generateCodeBtn,
      label: state.useSpecialPayrollLayout ? registrationCodeLabelSpecial : registrationCodeLabel,
      value: state.useSpecialPayrollLayout ? registrationCodeValueSpecial : registrationCodeValue,
      generatedMeta: state.useSpecialPayrollLayout ? codeGeneratedMetaSpecial : codeGeneratedMeta,
    });
  </script>
</body>
</html>
